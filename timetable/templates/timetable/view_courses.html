{% extends 'timetable/base.html' %}
{% load static %}

{% block content %}
<div class="view-courses-container">
    <div class="courses-navbar">
            <div class="navbar">

                <h3 class="mt-2 mb-2" style="margin-right: 20px;">
                    Courses
                </h3>

                

                <!-- Dropdown to filter by year -->
                <div class="dropdown">
                    <form method="get" action="{% url 'scheduler:view_courses' %}" class="year-form">
                        {% csrf_token %}
                            <div class="navbar">
                                <span style="margin-right: 10px;">
                                    
                                    <button class="btn btn-outline-secondary dropdown-toggle w-100 text-start" type="button" data-bs-toggle="dropdown" aria-expanded="false" id="dropdownButton" data-default="Year">
                                        Year Search
                                    </button>
                                    <ul class="dropdown-menu p-3" style="max-height: 200px; overflow-y: auto;">
                                        {% for year in years %}
                                        <li>
                                            <label class="form-check-label d-block">
                                                <input class="form-check-input me-1 year-checkbox" type="checkbox" name="year[]" value="{{ year }}">
                                                {{ year }}
                                            </label>
                                        </li>
                                        {% endfor %}
                                    </ul>
                                </span>
                                <button type="submit" class="btn btn-primary">Search Year</button>
                            </div>
                        </form>
                    </div>
            </div>


            <form method="get" action="{% url 'scheduler:view_courses' %}" class="mb-3 d-flex flex-wrap gap-3">
                <input type="text" name="code" placeholder="Code (e.g. FNH)" value="{{ code_query }}" class="form-control w-auto">
                <input type="text" name="number" placeholder="Number (e.g. 200)" value="{{ number_query }}" class="form-control w-auto">
                <input type="text" name="section" placeholder="Section (e.g. 001)" value="{{ section_query }}" class="form-control w-auto">
              
                <!-- ✅ Term checkboxes -->
                <div class="form-check form-check-inline">
                  <input class="form-check-input" type="checkbox" name="term" value="T1"
                         {% if "T1" in term_query %}checked{% endif %}>
                  <label class="form-check-label">T1</label>
                </div>
                <div class="form-check form-check-inline">
                  <input class="form-check-input" type="checkbox" name="term" value="T2"
                         {% if "T2" in term_query %}checked{% endif %}>
                  <label class="form-check-label">T2</label>
                </div>
                <div class="form-check form-check-inline">
                  <input class="form-check-input" type="checkbox" name="term" value="T1_T2"
                         {% if "T1_T2" in term_query %}checked{% endif %}>
                  <label class="form-check-label">T1_T2</label>
                </div>
              
                <!-- ✅ Year dropdown -->
                <select name="year" class="form-select w-auto">
                  <option value="">Year</option>
                  {% for y in years %}
                    <option value="{{ y }}" {% if y == year_query %}selected{% endif %}>{{ y }}</option>
                  {% endfor %}
                </select>
              
                <button type="submit" class="btn btn-primary">Search</button>
              </form>
              
    </div>

    <div class="d-flex justify-content-between mb-3">
        <a href="{% url 'scheduler:create_course' %}" class="btn btn-success">+ Add Course</a>
    </div>

    <!-- Courses Table -->
    <div class="table-wrapper table-responsive w-10 ml-5 mr-5">
        <table class="table table-bordered table-striped table-hover text-center">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Code</th>
                    <th>Number</th>
                    <th>Section</th>
                    <th>Term</th>
                    <th>Start</th>
                    <th>End</th>
                    <th>Day</th>
                    <th>Year</th>
                    <th>Edit</th>
                </tr>
            </thead>
            <tbody>
                {% for course in courses %}
                <tr>
                    <td>{{ course.id }}</td>
                    <td>{{ course.code }}</td>
                    <td>{{ course.number }}</td>
                    <td>{{ course.section }}</td>
                    <td>{{ course.term }}</td>
                    <td>{{ course.start_time }}</td>
                    <td>{{ course.end_time }}</td>
                    <td>{{ course.day }}</td>
                    <td>{{ course.academic_year }}</td>
                    <td>
                        <a href="{% url 'scheduler:edit_course' course.id %}" class="btn btn-warning btn-sm">Edit</a>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="9">No courses found.</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    
    <!--──────── PAGINATION CONTROLS ────────-->
    <div class="pagination-container mt-3 d-flex justify-content-center">
        <nav aria-label="Course pagination">
        <ul class="pagination">
    
            {% if page_obj.has_previous %}
            <li class="page-item">
                <a class="page-link"
                href="?{{ querystring }}&page={{ page_obj.previous_page_number }}">
                Previous
                </a>
            </li>
            {% else %}
            <li class="page-item disabled"><span class="page-link">Previous</span></li>
            {% endif %}
    
            {% for num in page_obj.paginator.page_range %}
            {% if page_obj.number == num %}
                <li class="page-item active"><span class="page-link">{{ num }}</span></li>
            {% else %}
                <li class="page-item">
                <a class="page-link"
                    href="?{{ querystring }}&page={{ num }}">
                    {{ num }}
                </a>
                </li>
            {% endif %}
            {% endfor %}
    
            {% if page_obj.has_next %}
            <li class="page-item">
                <a class="page-link"
                href="?{{ querystring }}&page={{ page_obj.next_page_number }}">
                Next
                </a>
            </li>
            {% else %}
            <li class="page-item disabled"><span class="page-link">Next</span></li>
            {% endif %}
    
        </ul>
        </nav>
    </div>
  
      
</div>

{% endblock %}
